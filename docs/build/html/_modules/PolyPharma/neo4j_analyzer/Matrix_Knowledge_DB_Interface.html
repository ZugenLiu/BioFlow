<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface &mdash; PolyPharma 0.2a3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2a3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PolyPharma 0.2a3 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PolyPharma 0.2a3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface</h1><div class="highlight"><pre>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;ank&#39;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains all the tools necessary to map GO ontology and Pathway classification from the database to an Adjacency and</span>
<span class="sd">Laplacian graph.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">PrettyPrinter</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">lil_matrix</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.csgraph</span> <span class="kn">import</span> <span class="n">shortest_path</span>
<span class="kn">from</span> <span class="nn">PolyPharma.configs</span> <span class="kn">import</span> <span class="n">Dumps</span><span class="p">,</span> <span class="n">Outputs</span><span class="p">,</span> <span class="n">UP_rand_samp</span>
<span class="kn">from</span> <span class="nn">PolyPharma.neo4j_Declarations.Graph_Declarator</span> <span class="kn">import</span> <span class="n">DatabaseGraph</span>
<span class="kn">from</span> <span class="nn">PolyPharma.Utils.GDF_export</span> <span class="kn">import</span> <span class="n">GDF_export_Interface</span>
<span class="kn">from</span> <span class="nn">PolyPharma.neo4j_analyzer.Matrix_Interactome_DB_interface</span> <span class="kn">import</span> <span class="n">MatrixGetter</span>
<span class="kn">from</span> <span class="nn">PolyPharma.neo4j_analyzer.IO_Routines</span> <span class="kn">import</span> <span class="n">dump_object</span><span class="p">,</span> <span class="n">undump_object</span>
<span class="kn">from</span> <span class="nn">PolyPharma.neo4j_analyzer</span> <span class="kn">import</span> <span class="n">Conduction_routines</span> <span class="k">as</span> <span class="n">CR</span>


<span class="c"># Creates an instance of MatrixGetter and loads pre-computed values</span>
<span class="n">MG</span> <span class="o">=</span> <span class="n">MatrixGetter</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">MG</span><span class="o">.</span><span class="n">fast_load</span><span class="p">()</span>

<span class="c"># TODO: switch to the usage of Uniprot set that is independent from the Matrix_Getter, but instead is supplide by the user</span>
    <span class="c"># MG.Uniprot is just an option, even though a very importatn one</span>

<span class="c"># specify the relations that lead to a more general or to an equally regulated node.</span>
<span class="n">GOUpTypes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;is_a_go&quot;</span><span class="p">,</span> <span class="s">&quot;is_part_of_go&quot;</span><span class="p">]</span>
<span class="n">GORegTypes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;is_Regulant&quot;</span><span class="p">]</span>


<span class="n">ppritner</span> <span class="o">=</span> <span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_characterise</span><span class="p">(</span><span class="n">objekt</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Object of size </span><span class="si">%s</span><span class="s"> and type </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objekt</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">objekt</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_characterise_mat</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Matrix of shape </span><span class="si">%s</span><span class="s">, type </span><span class="si">%s</span><span class="s"> and has </span><span class="si">%s</span><span class="s"> non-zero terms, min is </span><span class="si">%s</span><span class="s">, max is </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">matrix</span><span class="p">),</span>
                                                                <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&gt;&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="GO_Interface"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface">[docs]</a><span class="k">class</span> <span class="nc">GO_Interface</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General calss to recover all the informations associated with GO from database and buffer them for further use.</span>

<span class="sd">    :param Filter:</span>
<span class="sd">    :param Uniprot_Node_IDs: A list of hte Uniprots that will be used for the GO reach and informativity computation. Beyond</span>
<span class="sd">                                database and formalism issues, this allows to adapt method when limited list of UP is of interest</span>
<span class="sd">    :param corrfactor:</span>
<span class="sd">    :param Ultraspec_clean:</span>
<span class="sd">    :param Ultraspec_lvl: parameter how much uniprots have to point to a GO term for it not to be considered ultraspecific anymore</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Uniprot_Node_IDs</span><span class="p">,</span> <span class="n">corrfactor</span><span class="p">,</span> <span class="n">Ultraspec_clean</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Ultraspec_lvl</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span> <span class="o">=</span> <span class="n">Filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span> <span class="o">=</span> <span class="n">Uniprot_Node_IDs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrfactor</span> <span class="o">=</span> <span class="n">corrfactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_cleaned</span> <span class="o">=</span> <span class="n">Ultraspec_clean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span> <span class="o">=</span> <span class="n">Ultraspec_lvl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partial_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UPs_without_GO</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SeedSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_Entropy</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span> <span class="o">=</span><span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_step_Reachable_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_step_Reachable_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Weighted_Ent</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GO_Names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO_Legacy_IDs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rev_GO_IDs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Adjacency_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Weighted_Laplacian_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sign_retaining_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TimesReached</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accelerationDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Reverse_Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO_Node_ID2Reach</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># everytghing below should not be dumped, but should be exported to the mongoDB</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2UP_voltages</span> <span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2circ_and_voltage</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_current</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_coutner</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">char_set</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_ID</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">char_set</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>


<div class="viewcode-block" id="GO_Interface.pretty_time"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.pretty_time">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Times the execution</span>

<span class="sd">        :return: tuple containing the time since the creation of the Matrix_getter object and since the last cal of function formatted as string</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">it</span><span class="p">,</span> <span class="n">pt</span> <span class="o">=</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_time</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial_time</span><span class="p">))</span>
        <span class="n">pload</span> <span class="o">=</span> <span class="s">&#39;total: </span><span class="si">%s</span><span class="s"> m </span><span class="si">%s</span><span class="s"> s, </span><span class="se">\t</span><span class="s"> partial: </span><span class="si">%s</span><span class="s"> m </span><span class="si">%s</span><span class="s"> s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">it</span> <span class="o">%</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">pt</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partial_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pload</span>

</div>
    <span class="k">def</span> <span class="nf">_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial_time</span>
        <span class="k">return</span> <span class="n">pt</span>


<div class="viewcode-block" id="GO_Interface.call_show"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.call_show">[docs]</a>    <span class="k">def</span> <span class="nf">call_show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_coutner</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="k">print</span> <span class="s">&#39;*&#39;</span><span class="p">,</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_coutner</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_statics"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_statics">[docs]</a>    <span class="k">def</span> <span class="nf">dump_statics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_builder_stat</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span> <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corrfactor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_cleaned</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_statics"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_statics">[docs]</a>    <span class="k">def</span> <span class="nf">undump_statics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_builder_stat</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_core"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_core">[docs]</a>    <span class="k">def</span> <span class="nf">dump_core</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_dump</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeedSet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO_Names</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">GO_Legacy_IDs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_GO_IDs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UPs_without_GO</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_core"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_core">[docs]</a>    <span class="k">def</span> <span class="nf">undump_core</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeedSet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO_Names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO_Legacy_IDs</span><span class="p">,</span>\
        <span class="bp">self</span><span class="o">.</span><span class="n">rev_GO_IDs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UPs_without_GO</span> <span class="o">=</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_dump</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_matrices"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_matrices">[docs]</a>    <span class="k">def</span> <span class="nf">dump_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Mats</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Adjacency_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_adj_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_matrices"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_matrices">[docs]</a>    <span class="k">def</span> <span class="nf">undump_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Adjacency_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_adj_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span> <span class="o">=</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Mats</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_informativities"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_informativities">[docs]</a>    <span class="k">def</span> <span class="nf">dump_informativities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Infos</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_step_Reachable_nodes</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_step_Reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Weighted_Ent</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_informativities"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_informativities">[docs]</a>    <span class="k">def</span> <span class="nf">undump_informativities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_step_Reachable_nodes</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_step_Reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Weighted_Ent</span> <span class="o">=</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Infos</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_inflated_elements"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_inflated_elements">[docs]</a>    <span class="k">def</span> <span class="nf">dump_inflated_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Inflated</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_inflated_elements"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_inflated_elements">[docs]</a>    <span class="k">def</span> <span class="nf">undump_inflated_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span> <span class="o">=</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Inflated</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_memoized"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_memoized">[docs]</a>    <span class="k">def</span> <span class="nf">dump_memoized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">),</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;UP_hash&#39;</span> <span class="p">:</span> <span class="n">md5</span><span class="p">,</span>
                        <span class="s">&#39;sys_hash&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MD5hash</span><span class="p">(),</span>
                        <span class="s">&#39;size&#39;</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">),</span>
                        <span class="s">&#39;UPs&#39;</span> <span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">),</span>
                        <span class="s">&#39;currents&#39;</span> <span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_current</span><span class="p">)),</span>
                        <span class="s">&#39;voltages&#39;</span> <span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2circ_and_voltage</span><span class="p">)}</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Analysis_memoized</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_memoized"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_memoized">[docs]</a>    <span class="k">def</span> <span class="nf">undump_memoized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: undumped memoized analysis</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Analysis_memoized</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.dump_Indep_Linset"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.dump_Indep_Linset">[docs]</a>    <span class="k">def</span> <span class="nf">dump_Indep_Linset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Indep_Linset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.undump_Indep_Linset"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.undump_Indep_Linset">[docs]</a>    <span class="k">def</span> <span class="nf">undump_Indep_Linset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="o">=</span> <span class="n">undump_object</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">GO_Indep_Linset</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.store"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_statics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_core</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_matrices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_informativities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_inflated_elements</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="GO_Interface.rebuild"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.rebuild">[docs]</a>    <span class="k">def</span> <span class="nf">rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_GO_access</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_GO_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_matrixes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_GO_Reach</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_cleaned</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filter_out_ultraspecific</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_Laplacians</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflate_matrix_and_indexes</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="GO_Interface.load"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preloads itself from the saved dumps, in case the Filtering system is the same</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Filtr</span><span class="p">,</span> <span class="n">Initset</span><span class="p">,</span> <span class="n">corrfactor</span><span class="p">,</span> <span class="n">ultraspec_cleaned</span><span class="p">,</span> <span class="n">ultraspec_lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undump_statics</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span> <span class="o">!=</span> <span class="n">Filtr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Wrong Filtering attempted to be recovered from storage&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span> <span class="o">!=</span> <span class="n">Initset</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Wrong Initset attempted to be recovered from storage&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrfactor</span> <span class="o">!=</span> <span class="n">corrfactor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Wrong correction factor attempted to be recovered from storage&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_cleaned</span> <span class="o">!=</span> <span class="n">ultraspec_cleaned</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Ultraspecific terms leveling state is not the same in the database as requested&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span> <span class="o">!=</span> <span class="n">ultraspec_lvl</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Ultraspecific terms leveling cut-off is not the same in the database as requested&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undump_core</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undump_matrices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undump_informativities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undump_inflated_elements</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="GO_Interface.get_GO_access"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.get_GO_access">[docs]</a>    <span class="k">def</span> <span class="nf">get_GO_access</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all of the relations between the UNIPROTs and GOs as one giant dictionary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">UPs_without_GO</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">UP_DB_ID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span><span class="p">:</span>
            <span class="n">UP_Specific_GOs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Root</span> <span class="o">=</span> <span class="n">DatabaseGraph</span><span class="o">.</span><span class="n">UNIPORT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">UP_DB_ID</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span><span class="p">[</span><span class="n">UP_DB_ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Root</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">Root</span><span class="o">.</span><span class="n">displayName</span><span class="p">]</span>
            <span class="n">Node_gen</span> <span class="o">=</span> <span class="n">Root</span><span class="o">.</span><span class="n">bothV</span><span class="p">(</span><span class="s">&quot;is_go_annotation&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Node_gen</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">GO</span> <span class="ow">in</span> <span class="n">Node_gen</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">GO</span><span class="o">.</span><span class="n">Namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span><span class="p">:</span>
                        <span class="n">GOID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">GO</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">UP_Specific_GOs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GOID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP</span><span class="p">[</span><span class="n">GOID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UP_DB_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">SeedSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GOID</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">UP_Specific_GOs</span><span class="p">:</span>
                <span class="n">UPs_without_GO</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">print</span> <span class="s">&quot;Warning: UP without GO has been found. Database UP_DB_ID: </span><span class="si">%s</span><span class="s">, </span><span class="se">\t</span><span class="s"> name: </span><span class="si">%s</span><span class="s">!!!!!!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">UP_DB_ID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span><span class="p">[</span><span class="n">UP_DB_ID</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UPs_without_GO</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">UP_DB_ID</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="p">[</span><span class="n">UP_DB_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">UP_Specific_GOs</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;total number of UPs without a GO annotation: </span><span class="si">%s</span><span class="s"> out of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">UPs_without_GO</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.get_GO_structure"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.get_GO_structure">[docs]</a>    <span class="k">def</span> <span class="nf">get_GO_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all of the relations between the GOs that are generalisation of the seedList GOs and that are withing the types specified in Filtr</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VisitedSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">seedList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SeedSet</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">seedList</span><span class="p">:</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">seedList</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">VisitedSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">Local_UpList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Local_Regulation_List</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Local_InReg_List</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Local_DownList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">GONode</span> <span class="o">=</span> <span class="n">DatabaseGraph</span><span class="o">.</span><span class="n">GOTerm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GO_Names</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">GONode</span><span class="o">.</span><span class="n">displayName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GO_Legacy_IDs</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">GONode</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rev_GO_IDs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">GONode</span><span class="o">.</span><span class="n">ID</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ID</span>
            <span class="k">for</span> <span class="n">Typ</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="n">GOUpTypes</span><span class="p">,</span> <span class="n">GORegTypes</span><span class="p">):</span>
                <span class="n">generator</span> <span class="o">=</span> <span class="n">GONode</span><span class="o">.</span><span class="n">outV</span><span class="p">(</span><span class="n">Typ</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">generator</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c"># skip in case GO Node has no outgoing relations to other GO nodes</span>
                <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">elt</span><span class="o">.</span><span class="n">Namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span><span class="p">:</span>
                        <span class="k">continue</span>  <span class="c"># skip in case other GO nodes are of bad type (normally skopes are well-separated, but who knows)</span>
                    <span class="n">subID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">subID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VisitedSet</span><span class="p">:</span>
                        <span class="n">seedList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subID</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Typ</span> <span class="ow">in</span> <span class="n">GOUpTypes</span><span class="p">:</span>
                        <span class="n">Local_UpList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subID</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Local_Regulation_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subID</span><span class="p">)</span>
                <span class="n">rev_generator</span> <span class="o">=</span> <span class="n">GONode</span><span class="o">.</span><span class="n">inV</span><span class="p">(</span><span class="n">Typ</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rev_generator</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">rev_generator</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">elt</span><span class="o">.</span><span class="n">Namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">subID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">Typ</span> <span class="ow">in</span> <span class="n">GOUpTypes</span><span class="p">:</span>
                        <span class="n">Local_DownList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subID</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Local_InReg_List</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subID</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Local_UpList</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Local_Regulation_List</span><span class="p">)),</span>
                                             <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Local_DownList</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Local_InReg_List</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">VisitedSet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">)</span> <span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.get_matrixes"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.get_matrixes">[docs]</a>    <span class="k">def</span> <span class="nf">get_matrixes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_reg</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds Undirected and directed adjacency matrices for the GO set and</span>

<span class="sd">        :param include_reg: if True, the regulation set is included into the matrix</span>
<span class="sd">        :warning: if the parameter above is set to False, get_GO_reach module will be unable to function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">build_adjacency</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Builds undirected adjacency matrix for the GO transitions</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">baseMatrix</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">package</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">fw_nodes</span> <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">include_reg</span><span class="p">:</span>
                    <span class="n">fw_nodes</span> <span class="o">+=</span> <span class="n">package</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">fw_nodes</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">node2</span><span class="p">])</span>
                    <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Adjacency_matrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">baseMatrix</span><span class="p">)</span>



        <span class="k">def</span> <span class="nf">build_dir_adj</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Builds directed adjacency matrix for the GO transitions</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">baseMatrix</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">package</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">fw_nodes</span> <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">include_reg</span><span class="p">:</span>
                    <span class="n">fw_nodes</span> <span class="o">+=</span> <span class="n">package</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">fw_nodes</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">node2</span><span class="p">])</span>
                    <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dir_adj_matrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">baseMatrix</span><span class="p">)</span>

        <span class="n">build_adjacency</span><span class="p">()</span>
        <span class="n">build_dir_adj</span><span class="p">()</span>

</div>
    <span class="k">def</span> <span class="nf">_infcalc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns an entropy given by a number of equiprobable events, where event is the number.</span>

<span class="sd">        :param number:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Wrong value provided for entropy computation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_Entropy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_Entropy</span> <span class="o">=</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
             <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">total_Entropy</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">corrfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">total_Entropy</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrfactor</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<div class="viewcode-block" id="GO_Interface.get_GO_Reach"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.get_GO_Reach">[docs]</a>    <span class="k">def</span> <span class="nf">get_GO_Reach</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recovers by how many different uniprots each GO term is reached, both in distance-agnostic and distance-specific</span>
<span class="sd">        terms.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">verify_equivalence_of_reaches</span><span class="p">(</span><span class="n">step_reach</span><span class="p">,</span> <span class="n">reach</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">            :param step_reach:</span>
<span class="sd">            :param reach:</span>
<span class="sd">            :raise Exception:</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">lendict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_reach</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">reach</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">lendict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Reach exploration results not equivalent! Please report the error.&#39;</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">special_sum</span><span class="p">(</span><span class="n">Dico</span><span class="p">,</span> <span class="n">filter_funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mf">1.0</span> <span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Special sum used for the computation of staged informativity of different terms</span>

<span class="sd">            :param Dico:</span>
<span class="sd">            :param filter_funct:</span>
<span class="sd">            :raise Exception:</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">summer</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="n">Dico</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">summer</span> <span class="o">+=</span> <span class="n">filter_funct</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">summer</span>


        <span class="n">dir_reg_path</span> <span class="o">=</span> <span class="n">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_adj_matrix</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span> <span class="p">)</span>
        <span class="n">dir_reg_path</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">dir_reg_path</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">dir_reg_path</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">(</span><span class="n">dir_reg_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">el</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reachable_nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2UP</span><span class="p">)</span>

        <span class="n">pre_GO2UP_step_reachable_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="c"># when called on possibly unencoutenred items, anticipate a default falue of 10 000</span>

        <span class="c"># Now just scan vertical columns and add UP terms attached</span>
        <span class="k">for</span> <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dir_reg_path</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">list</span><span class="p">(</span><span class="n">dir_reg_path</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx2</span><span class="p">]]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">dir_reg_path</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;null in non-null patch&quot;</span><span class="p">)</span>
            <span class="n">step_reach_upgrade</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">+</span> <span class="n">dir_reg_path</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pre_GO2UP_step_reachable_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx1</span><span class="p">]]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">step_reach_upgrade</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">pre_GO2UP_step_reachable_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx2</span><span class="p">]][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pre_GO2UP_step_reachable_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx2</span><span class="p">]]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">100000</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="n">verify_equivalence_of_reaches</span><span class="p">(</span><span class="n">pre_GO2UP_step_reachable_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">)</span>

        <span class="c"># Now we need to invert the reach to get the set of all the primary and derived GO terms that describe a UP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_step_Reachable_nodes</span><span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_step_Reachable_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pre_GO2UP_step_reachable_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_dict</span> <span class="ow">in</span> <span class="n">pre_GO2UP_step_reachable_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_step_Reachable_nodes</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_step_Reachable_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c"># and finally we compute the pure and weighted informativities for each term</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infcalc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Weighted_Ent</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infcalc</span><span class="p">(</span><span class="n">special_sum</span><span class="p">(</span><span class="n">val_dict</span><span class="p">)))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_step_Reachable_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="GO_Interface.get_Laplacians"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.get_Laplacians">[docs]</a>    <span class="k">def</span> <span class="nf">get_Laplacians</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recovers the Laplacian (information conductance) matrixes for the GO annotation terms.</span>
<span class="sd">        For weighted laplacian, currently implements a Max-Ent with custom factor as transition price.</span>

<span class="sd">        :warning: for this method to function, get_GO reach function must be run first.</span>
<span class="sd">        :warning: accounting for regulatory relation relation between the GO terms is performed if has been done in the adjunction matrix computation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">baseMatrix</span> <span class="o">=</span> <span class="o">-</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_adj_matrix</span><span class="p">)</span>
        <span class="n">nz_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baseMatrix</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="n">baseMatrix</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">])))</span>

        <span class="k">for</span> <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="ow">in</span> <span class="n">nz_list</span><span class="p">:</span>
            <span class="n">minInf</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx1</span><span class="p">]],</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">[</span><span class="n">idx2</span><span class="p">]])</span>
            <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">minInf</span>
            <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">idx1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">minInf</span>
            <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minInf</span>
            <span class="n">baseMatrix</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minInf</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span> <span class="o">=</span> <span class="n">baseMatrix</span>

</div>
<div class="viewcode-block" id="GO_Interface.compute_UniprotDict"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.compute_UniprotDict">[docs]</a>    <span class="k">def</span> <span class="nf">compute_UniprotDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uniprot method requried by some other dictionary</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">UniprotDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">MG</span><span class="o">.</span><span class="n">Uniprots</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">DatabaseGraph</span><span class="o">.</span><span class="n">UNIPORT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
            <span class="n">altID</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">ID</span>
            <span class="n">UniprotDict</span><span class="p">[</span><span class="n">altID</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">MG</span><span class="o">.</span><span class="n">ID2displayName</span><span class="p">[</span><span class="n">elt</span><span class="p">])</span> <span class="c"># TODO: now can be supressed</span>
            <span class="n">UniprotDict</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">=</span> <span class="n">altID</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">UniprotDict</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span><span class="n">Dumps</span><span class="o">.</span><span class="n">Up_dict_dump</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">UniprotDict</span>

</div>
<div class="viewcode-block" id="GO_Interface.filter_out_ultraspecific"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.filter_out_ultraspecific">[docs]</a>    <span class="k">def</span> <span class="nf">filter_out_ultraspecific</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters out GO terms that are too specific and builds a directed, undirected adjacency maps and laplacian.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rep_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infcalc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_cleaned</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">ultraspec_GOs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">GO</span> <span class="k">for</span> <span class="n">GO</span><span class="p">,</span> <span class="n">reach</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reach</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">GO</span> <span class="ow">in</span> <span class="n">ultraspec_GOs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">[</span><span class="n">GO</span><span class="p">]</span> <span class="o">=</span> <span class="n">rep_val</span>

</div>
    <span class="k">def</span> <span class="nf">_MD5hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the MD hash of self to ensure that all the defining properties have been correctly defined before dump/retrieval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sorted_initset</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Filtr</span><span class="p">,</span> <span class="n">sorted_initset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrfactor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_cleaned</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span><span class="p">]</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">md5</span><span class="p">)</span>


<div class="viewcode-block" id="GO_Interface.inflate_matrix_and_indexes"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.inflate_matrix_and_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">inflate_matrix_and_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the laplacian matrix inflation to incorporate the uniprots on which we will be running the</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># branching distribution: at least 10x the biggest conductivity of the system, unless ultrasec, in which case ~ ultraspec level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_infcalc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ultraspec_lvl</span><span class="p">)</span>
        <span class="n">fixed_Index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">self_connectable_UPs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UPs_without_GO</span><span class="p">))</span>
        <span class="n">UP2IDxs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">UP</span><span class="p">,</span> <span class="n">fixed_Index</span><span class="o">+</span><span class="n">Idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">Idx</span><span class="p">,</span> <span class="n">UP</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">self_connectable_UPs</span><span class="p">))</span>
        <span class="n">IDx2UPs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">Idx</span><span class="p">,</span> <span class="n">UP</span><span class="p">)</span> <span class="k">for</span> <span class="n">UP</span><span class="p">,</span> <span class="n">Idx</span> <span class="ow">in</span> <span class="n">UP2IDxs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">self_connectable_UPs</span><span class="p">),</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">self_connectable_UPs</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Laplacian_matrix</span>

        <span class="k">for</span> <span class="n">UP</span> <span class="ow">in</span> <span class="n">self_connectable_UPs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">GO</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="p">[</span><span class="n">UP</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">[</span><span class="n">UP2IDxs</span><span class="p">[</span><span class="n">UP</span><span class="p">],</span> <span class="n">UP2IDxs</span><span class="p">[</span><span class="n">UP</span><span class="p">]]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">GO</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">GO</span><span class="p">]]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">GO</span><span class="p">],</span> <span class="n">UP2IDxs</span><span class="p">[</span><span class="n">UP</span><span class="p">]]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">[</span><span class="n">UP2IDxs</span><span class="p">[</span><span class="n">UP</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">GO</span><span class="p">]]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">UP2IDxs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Num2GO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">IDx2UPs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GO_Interface.set_Uniprot_source"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.set_Uniprot_source">[docs]</a>    <span class="k">def</span> <span class="nf">set_Uniprot_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Uniprots</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the Uniprots on which the circulation computation routines will be performed by the otehr methods.</span>
<span class="sd">        Avoids passing as argument large lists of parameters.</span>

<span class="sd">        :param Uniprots: List of node IDs of the uniprots on which we would like to perform current computations</span>
<span class="sd">        :raise Warning: if the uniprots were not present in the set of GOs for which we built the system or had no GO attached to them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">Uniprots</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">ex_pload</span> <span class="o">=</span> <span class="s">&#39;Following Uniprots either were not in the construction set or have no GOs attached: </span><span class="se">\n</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Uniprots</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">ex_pload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span> <span class="o">=</span> <span class="n">Uniprots</span>

</div>
<div class="viewcode-block" id="GO_Interface.build_extended_conduction_system"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.build_extended_conduction_system">[docs]</a>    <span class="k">def</span> <span class="nf">build_extended_conduction_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memoized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sourced</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">incremental</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cancellation</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a conduction matrix that integrates uniprots, in order to allow an easier knowledge flow analysis</span>

<span class="sd">        :param memoized: if the tensions and individual relation matrices should be stored in the matrix and dumped at the end computation (required for submatrix recomputation)</span>
<span class="sd">        :param sourced: if true, all the raltions will be looked up and not computed. Useful for the retrieval of subcirculation group, but requires the UP2voltage_and_circ to be pre-filled</span>
<span class="sd">        :param incremental: if True, all the circulation computation will be added to the existing ones. Usefull for the computation of particularly big systems with intermediate dumps</span>
<span class="sd">        :param cancellation: divides the final current by #Nodes**2/2, i.e. makes the currents comparable between circulation systems of differnet  sizes.</span>
<span class="sd">        :return: adjusted conduction system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">incremental</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UP2UP_voltages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sourced</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UP2circ_and_voltage</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">UP1</span><span class="p">,</span> <span class="n">UP2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">sourced</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">+</span>\
                                           <span class="n">CR</span><span class="o">.</span><span class="n">sparse_abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2circ_and_voltage</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">UP1</span><span class="p">,</span> <span class="n">UP2</span><span class="p">)))][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="n">Idx1</span><span class="p">,</span> <span class="n">Idx2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="p">[</span><span class="n">UP1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="p">[</span><span class="n">UP2</span><span class="p">])</span>
            <span class="n">pre_reach</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span><span class="p">[</span><span class="n">UP1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span><span class="p">[</span><span class="n">UP2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">UP1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">UP2</span><span class="p">]</span>
            <span class="n">reach</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pre_reach</span><span class="p">]</span>
            <span class="n">current_upper</span><span class="p">,</span> <span class="n">voltage_diff</span> <span class="o">=</span> <span class="n">CR</span><span class="o">.</span><span class="n">get_current_with_reach_limitations</span><span class="p">(</span><span class="n">inflated_laplacian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_Laplacian</span><span class="p">,</span>
                                                            <span class="n">Idx_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">Idx1</span><span class="p">,</span> <span class="n">Idx2</span><span class="p">),</span>
                                                            <span class="n">reach_limiter</span> <span class="o">=</span> <span class="n">reach</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">+</span> <span class="n">CR</span><span class="o">.</span><span class="n">sparse_abs</span><span class="p">(</span><span class="n">current_upper</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">UP2UP_voltages</span><span class="p">[(</span><span class="n">UP1</span><span class="p">,</span> <span class="n">UP2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">voltage_diff</span>

            <span class="k">if</span> <span class="n">memoized</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UP2circ_and_voltage</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">UP1</span><span class="p">,</span> <span class="n">UP2</span><span class="p">)))]</span> <span class="o">=</span> <span class="p">(</span><span class="n">voltage_diff</span><span class="p">,</span> <span class="n">current_upper</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cancellation</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span><span class="o">/</span><span class="p">(</span><span class="n">ln</span><span class="o">*</span><span class="p">(</span><span class="n">ln</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">memoized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_memoized</span><span class="p">()</span>

        <span class="n">index_current</span> <span class="o">=</span> <span class="n">CR</span><span class="o">.</span><span class="n">get_current_through_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_current</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index_current</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GO_Interface.format_Node_props"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.format_Node_props">[docs]</a>    <span class="k">def</span> <span class="nf">format_Node_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_current</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">):</span>
        <span class="n">charDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">GO</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node_current</span><span class="p">[</span><span class="n">GO</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">:</span>
                <span class="n">charDict</span><span class="p">[</span><span class="n">GO</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">node_current</span><span class="p">[</span><span class="n">GO</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">[</span><span class="n">GO</span><span class="p">],</span>
                                 <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="n">GO</span><span class="p">])]</span>
        <span class="k">return</span> <span class="n">charDict</span>

</div>
<div class="viewcode-block" id="GO_Interface.export_conduction_system"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.export_conduction_system">[docs]</a>    <span class="k">def</span> <span class="nf">export_conduction_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the conduction system of the GO terms and exports it to the GDF format and flushes it into a file that</span>
<span class="sd">        can be viewed with Gephi</span>

<span class="sd">        :raise Warning:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodecharnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Current&#39;</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;Legacy_ID&#39;</span><span class="p">,</span> <span class="s">&#39;Names&#39;</span><span class="p">,</span> <span class="s">&#39;Pure_informativity&#39;</span><span class="p">,</span> <span class="s">&#39;Confusion_potential&#39;</span><span class="p">]</span>
        <span class="n">nodechartypes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DOUBLE&#39;</span><span class="p">,</span> <span class="s">&#39;VARCHAR&#39;</span><span class="p">,</span> <span class="s">&#39;VARCHAR&#39;</span><span class="p">,</span> <span class="s">&#39;VARCHAR&#39;</span><span class="p">,</span> <span class="s">&#39;DOUBLE&#39;</span><span class="p">,</span> <span class="s">&#39;DOUBLE&#39;</span><span class="p">]</span>
        <span class="n">charDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">GO</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="n">charDict</span><span class="p">[</span><span class="n">GO</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_current</span><span class="p">[</span><span class="n">GO</span><span class="p">]),</span>
                             <span class="s">&#39;GO&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO_Legacy_IDs</span><span class="p">[</span><span class="n">GO</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">GO_Names</span><span class="p">[</span><span class="n">GO</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">),</span>
                             <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2_Pure_Inf</span><span class="p">[</span><span class="n">GO</span><span class="p">]),</span>
                             <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="n">GO</span><span class="p">]))]</span>

        <span class="k">for</span> <span class="n">UP</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">:</span>
            <span class="n">charDict</span><span class="p">[</span><span class="n">UP</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_current</span><span class="p">[</span><span class="n">UP</span><span class="p">]),</span>
                             <span class="s">&#39;UP&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span><span class="p">[</span><span class="n">UP</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                             <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP_Names</span><span class="p">[</span><span class="n">UP</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">),</span>
                             <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_intesity</span><span class="p">),</span>
                             <span class="s">&#39;1&#39;</span><span class="p">]</span>

        <span class="n">GDF_exporter</span> <span class="o">=</span> <span class="n">GDF_export_Interface</span><span class="p">(</span><span class="n">target_fname</span> <span class="o">=</span> <span class="n">Outputs</span><span class="o">.</span><span class="n">GO_GDF_output</span><span class="p">,</span> <span class="n">field_names</span> <span class="o">=</span> <span class="n">nodecharnames</span><span class="p">,</span>
                                            <span class="n">field_types</span> <span class="o">=</span> <span class="n">nodechartypes</span><span class="p">,</span> <span class="n">node_properties_dict</span> <span class="o">=</span> <span class="n">charDict</span><span class="p">,</span>
                                            <span class="n">mincurrent</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">Idx2Label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_idx2lbl</span><span class="p">,</span> <span class="n">Label2Idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflated_lbl2idx</span><span class="p">,</span>
                                            <span class="n">current_Matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span><span class="p">)</span>
        <span class="n">GDF_exporter</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="GO_Interface.export_subsystem"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.export_subsystem">[docs]</a>    <span class="k">def</span> <span class="nf">export_subsystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">UP_system</span><span class="p">,</span> <span class="n">UP_subsystem</span><span class="p">):</span>
        <span class="n">current_recombinator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undump_memoized</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">UP_system</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">current_recombinator</span><span class="p">[</span><span class="s">&#39;UPs&#39;</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Wrong UP system re-analyzed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UP2circ_and_voltage</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">current_recombinator</span><span class="p">[</span><span class="s">&#39;voltages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Uniprot_source</span><span class="p">(</span><span class="n">UP_subsystem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_extended_conduction_system</span><span class="p">(</span><span class="n">memoized</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sourced</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_conduction_system</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="GO_Interface.randomly_sample"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.randomly_sample">[docs]</a>    <span class="k">def</span> <span class="nf">randomly_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples_size</span><span class="p">,</span> <span class="n">samples_each_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomly samples the set</span>

<span class="sd">        :param samples_size:</span>
<span class="sd">        :param samples_each_size:</span>
<span class="sd">        :raise Exception:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_size</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_each_size</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Not the same list sizes!&#39;</span><span class="p">)</span>

        <span class="n">self_connectable_UPs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InitSet</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UPs_without_GO</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">iterations</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samples_size</span><span class="p">,</span> <span class="n">samples_each_size</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
                <span class="n">shuffle</span><span class="p">(</span><span class="n">self_connectable_UPs</span><span class="p">)</span>
                <span class="n">analytics_UP_list</span> <span class="o">=</span> <span class="n">self_connectable_UPs</span><span class="p">[:</span><span class="n">sample_size</span><span class="p">]</span>
                <span class="c"># print analytics_UP_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_Uniprot_source</span><span class="p">(</span><span class="n">analytics_UP_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">build_extended_conduction_system</span><span class="p">(</span><span class="n">memoized</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sourced</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

                <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">analytics_UP_list</span><span class="p">),</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

                <span class="n">UP_rand_samp</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;UP_hash&#39;</span> <span class="p">:</span> <span class="n">md5</span><span class="p">,</span>
                                     <span class="s">&#39;sys_hash&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MD5hash</span><span class="p">(),</span>
                                     <span class="s">&#39;size&#39;</span> <span class="p">:</span> <span class="n">sample_size</span><span class="p">,</span>
                                     <span class="s">&#39;UPs&#39;</span> <span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">analytics_UP_list</span><span class="p">),</span>
                                     <span class="s">&#39;currents&#39;</span> <span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_accumulator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_current</span><span class="p">)),</span>
                                     <span class="s">&#39;voltages&#39;</span> <span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UP2UP_voltages</span><span class="p">)})</span>

                <span class="k">print</span> <span class="s">&#39;Random ID: </span><span class="si">%s</span><span class="s"> </span><span class="se">\t</span><span class="s"> Sample size: </span><span class="si">%s</span><span class="s"> </span><span class="se">\t</span><span class="s"> iteration: </span><span class="si">%s</span><span class="se">\t</span><span class="s"> compops: </span><span class="si">%s</span><span class="s"> </span><span class="se">\t</span><span class="s"> time: </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_ID</span><span class="p">,</span>
                        <span class="n">sample_size</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s">&quot;{0:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_size</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="GO_Interface.get_indep_linear_groups"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.html#PolyPharma.neo4j_analyzer.Matrix_Knowledge_DB_Interface.GO_Interface.get_indep_linear_groups">[docs]</a>    <span class="k">def</span> <span class="nf">get_indep_linear_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">All_GOs</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">GO_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UP2GO_Reachable_nodes</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">GO1</span><span class="p">,</span> <span class="n">GO2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">GO_list</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">GO1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GO2Num</span><span class="p">[</span><span class="n">GO2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">idx1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Indep_Lapl</span> <span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">filtr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;biological_process&#39;</span><span class="p">]</span>

    <span class="c"># Edit to supress the MG.Uniprots values.</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">GO_Interface</span><span class="p">(</span><span class="n">filtr</span><span class="p">,</span> <span class="n">MG</span><span class="o">.</span><span class="n">Uniprot_complete</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>
    <span class="c"># experimental = [&#39;186958&#39;, &#39;142401&#39;, &#39;147798&#39;, &#39;164077&#39;, &#39;162624&#39;, &#39;181770&#39;, &#39;113303&#39;, &#39;160359&#39;, &#39;133344&#39;, &#39;178502&#39;]</span>
    <span class="c">#</span>
    <span class="c"># KG.load()</span>
    <span class="c"># print KG.pretty_time()</span>
    <span class="c"># KG.get_indep_linear_groups()</span>
    <span class="c"># KG.dump_Indep_Linset()</span>
    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c">#</span>
    <span class="c"># KG.randomly_sample([10], [5])</span>
    <span class="c">#</span>
    <span class="c"># KG.set_Uniprot_source(experimental)</span>
    <span class="c"># KG.build_extended_conduction_system()</span>
    <span class="c"># KG.export_conduction_system()</span>
    <span class="c">#</span>
    <span class="c"># KG.export_subsystem(experimental, [&#39;186958&#39;, &#39;142401&#39;, &#39;147798&#39;, &#39;164077&#39;])</span>




    <span class="c"># TODO: build a theoretic &quot;surprise&quot; level estimator, comapare with experimental &quot;surprise&quot; of the GO terms with certain confusion/informativity observation</span>

    <span class="c"># TODO: estimate how likely it is to get a term with informativity x at a size N and what is the expectend number of terms, use the Benjamin-Hoechberg method</span>
            <span class="c"># to remove the most unlikely ones.</span>

    <span class="c"># Non-trivial interesting GOs: reach between 3 and 200. For them, we should calculate the hidden strong importance</span>
    <span class="c"># terms, i.e. routing over X percent of information =&gt; UP importance for GO terms.</span>

    <span class="c"># loading takes 1-6 seconds.</span>
    <span class="c"># fill for reach only is done in 2 seconds,</span>
    <span class="c"># tepping takes another 15,</span>
    <span class="c"># inverting + info computation - 1 more second</span>
    <span class="c"># Laplacian building =&gt;</span>

    <span class="c"># full computation - 3 minutes 18 seconds; save 7 seconds, retrieval - 3 seconds</span>

    <span class="c"># data_array = np.array([log(val) for val in KG.GO2_Pure_Inf.itervalues()])</span>
    <span class="c"># hist(data_array, 100, log=True)</span>
    <span class="c"># show()</span>

    <span class="c"># UP confusion matrix by GO Term?</span>
        <span class="c"># =&gt; coefficient of corelation?</span>
    <span class="c"># GO specificity (i.e. how fully the given UP set covers a given GO term )</span>
    <span class="c"># GO recall (i.e. how many UPs a given GO term covers from a given set? )</span>
    <span class="c"># GO confusion power: i.e. knowing just that GO terms, how many terms out of this set would we retrieve? in case of</span>
    <span class="c"># an equiprobable pulling out of all the UP terms you know are annotated with such a GO?</span>

    <span class="c"># How can we scale it with introducing credibility values for the Uniprots?</span>

    <span class="c"># Sorting on the probability of confusion with a random sample, of addition of a random sample of a given size to the</span>
    <span class="c"># GO analysis system?</span>

    <span class="c"># what would be the probability of a set with a given informativity popping out on random for a given selection of terms?</span>

    <span class="c"># in order to perform the correct implementation, we need to draw a graph of the correlation between the confusion</span>
    <span class="c"># of the minimal informativity GO term of a set and the tension required to transmit the information</span>

    <span class="c"># Problem: ultraspecificity requires a pretty strong re-manipulation of both GOs and matrix construction routines after</span>
    <span class="c"># the matrices have been build.</span>

    <span class="c"># Wouldn&#39;t it be easier just to repress the informativity they induce by modifying the correction factors in the</span>
    <span class="c"># information functions?</span>
        <span class="c"># =&gt; Now, the distortion the uinduce is more then 10 times stronger. In addition the presence of this terms</span>
        <span class="c"># would greatly slow the matrix computation performance. (there are almost 3000 of them: a third of all the GO terms)</span>
    <span class="c"># What we could do is just to ceil the informativity of terms on the x-term informaitivity</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PolyPharma 0.2a3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Andrei Kucharavy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>