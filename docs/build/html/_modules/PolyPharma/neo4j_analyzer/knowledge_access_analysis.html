<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PolyPharma.neo4j_analyzer.knowledge_access_analysis &mdash; PolyPharma 0.2a3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2a3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PolyPharma 0.2a3 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PolyPharma 0.2a3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for PolyPharma.neo4j_analyzer.knowledge_access_analysis</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Builds on the knowledge</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;ank&#39;</span>

<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">PrettyPrinter</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">lil_matrix</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">eigsh</span>
<span class="kn">from</span> <span class="nn">Matrix_Interactome_DB_interface</span> <span class="kn">import</span>  <span class="n">MatrixGetter</span>
<span class="kn">from</span> <span class="nn">Matrix_Knowledge_DB_Interface</span> <span class="kn">import</span> <span class="n">GO_Interface</span>
<span class="kn">from</span> <span class="nn">PolyPharma.configs</span> <span class="kn">import</span> <span class="n">UP_rand_samp</span>
<span class="kn">from</span> <span class="nn">PolyPharma.Utils.dataviz</span> <span class="kn">import</span> <span class="n">kde_compute</span>
<span class="kn">from</span> <span class="nn">PolyPharma.Utils.Linalg_routines</span> <span class="kn">import</span> <span class="n">analyze_eigvects</span><span class="p">,</span> <span class="n">cluster_nodes</span><span class="p">,</span> <span class="n">submatrix</span><span class="p">,</span> <span class="n">remaineder_matrix</span><span class="p">,</span> <span class="n">Lapl_normalize</span>


<span class="n">filtr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;biological_process&#39;</span><span class="p">]</span>
<span class="n">corrfactors</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pprinter</span> <span class="o">=</span> <span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">MG</span> <span class="o">=</span> <span class="n">MatrixGetter</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">MG</span><span class="o">.</span><span class="n">fast_load</span><span class="p">()</span>


<div class="viewcode-block" id="KG_gen"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.KG_gen">[docs]</a><span class="k">def</span> <span class="nf">KG_gen</span><span class="p">():</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">GO_Interface</span><span class="p">(</span><span class="n">filtr</span><span class="p">,</span> <span class="n">MG</span><span class="o">.</span><span class="n">Uniprot_complete</span><span class="p">,</span> <span class="n">corrfactors</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">KG</span>

</div>
<div class="viewcode-block" id="spawn_sampler"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.spawn_sampler">[docs]</a><span class="k">def</span> <span class="nf">spawn_sampler</span><span class="p">(</span><span class="n">sample_size_list_plus_iteration_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spawns a sampler initalized from the default GO_Interface</span>

<span class="sd">    :param sample_size_list_plus_iteration_list: combined list of sample swizes and iterations (requried for Pool.map usage)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">KG_gen</span><span class="p">()</span>
    <span class="n">sample_size_list</span> <span class="o">=</span> <span class="n">sample_size_list_plus_iteration_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">iteration_list</span> <span class="o">=</span> <span class="n">sample_size_list_plus_iteration_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">randomly_sample</span><span class="p">(</span><span class="n">sample_size_list</span><span class="p">,</span> <span class="n">iteration_list</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="spawn_sampler_pool"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.spawn_sampler_pool">[docs]</a><span class="k">def</span> <span class="nf">spawn_sampler_pool</span><span class="p">(</span><span class="n">pool_size</span><span class="p">,</span> <span class="n">sample_size_list</span><span class="p">,</span> <span class="n">interation_list_per_pool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spawns a pool of samplers of the information flow within the GO system</span>

<span class="sd">    :param pool_size: number of processes that are performing the sample pooling and analyzing</span>
<span class="sd">    :param sample_size_list: size of the sample list</span>
<span class="sd">    :param interation_list_per_pool: number of iterations performing the pooling of the samples in each list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">pool_size</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sample_size_list</span><span class="p">,</span> <span class="n">interation_list_per_pool</span><span class="p">)]</span>
    <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">spawn_sampler</span><span class="p">,</span> <span class="n">payload</span> <span class="o">*</span> <span class="n">pool_size</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="select"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.select">[docs]</a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">tri_array</span><span class="p">,</span> <span class="n">array_column</span><span class="p">,</span> <span class="n">selection_span</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convinient small function to select a from tri_array all the elements where the column number array_column</span>
<span class="sd">    is within the selection span</span>

<span class="sd">    :param tri_array: the matrix on which we will be performing the selection</span>
<span class="sd">    :param array_column: column on which the selection span will be applied</span>
<span class="sd">    :param selection_span: span for which we are going to keep the column.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">selection_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">tri_array</span><span class="p">[</span><span class="n">array_column</span><span class="p">,</span> <span class="p">:],</span> <span class="n">tri_array</span><span class="p">[</span><span class="n">array_column</span><span class="p">,</span> <span class="p">:]</span><span class="o">&lt;</span> <span class="n">selection_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]])</span>
    <span class="n">decvec</span> <span class="o">=</span> <span class="n">tri_array</span><span class="p">[:,</span> <span class="n">selector</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">decvec</span>


</div>
<div class="viewcode-block" id="show_corrs"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.show_corrs">[docs]</a><span class="k">def</span> <span class="nf">show_corrs</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">,</span> <span class="n">meancorrs</span><span class="p">,</span> <span class="n">eigvals</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">test_tri_corr_array</span><span class="p">,</span> <span class="n">test_meancorr</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">resamples</span><span class="p">):</span>

    <span class="c"># TODO: there is a lot of repetition depending on which values are the biggest, test-setted or real setted.</span>
    <span class="c"># In all, we should be able to reduce it to two functions: scatterplot and histogram with two sets that</span>
    <span class="c"># should go into the dataviz module</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A general function that performs demonstration of an example of random samples of the same size as our sample</span>
<span class="sd">    and of our sample and conducts the statistical tests on wherther any of nodes or functional groups in our</span>
<span class="sd">    sample are non-random</span>

<span class="sd">    :param tri_corr_array: [[current, informativity, confusion_potential], ...] - characteristics of the random samples</span>
<span class="sd">    :param meancorrs: [[cluster size, average internode connection], ...] - characteristics of clustering random samples with the same parameters</span>
<span class="sd">    :param eigvals: eigenvalues associated to the interconnection matrix of random samples</span>
<span class="sd">    :param selector: range on which we would like to visually zoom and plot a histogram</span>
<span class="sd">    :param test_tri_corr_array: [[current, informativity, confusion_potential], ...] - characteristics of the true sample. If none, nothing happens</span>
<span class="sd">    :param test_meancorr: [[cluster size, average internode connection], ...] - characteristics of clustering the true sample</span>
<span class="sd">    :param eigval: eigenvalues associated to the interconnection matrix of the true sample</span>
<span class="sd">    :param resamples: how many random samples we analyzed for the default model</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">KG_gen</span><span class="p">()</span>
    <span class="n">inf_sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">KG</span><span class="o">.</span><span class="n">_infcalc</span><span class="p">(</span><span class="n">selector</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">KG</span><span class="o">.</span><span class="n">_infcalc</span><span class="p">(</span><span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">331</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;current through nodes&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">332</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;test current vs pure informativity&#39;</span><span class="p">)</span>
    <span class="c"># better2D_desisty_plot(tri_corr_array[0, :], tri_corr_array[1, :])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span> <span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span> <span class="n">inf_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inf_sel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">333</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;test current v.s. confusion potential&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span> <span class="n">selector</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">334</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Gaussian KDE current_info&#39;</span><span class="p">)</span>
    <span class="n">estimator_function</span> <span class="o">=</span> <span class="n">kde_compute</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">:],</span> <span class="mi">50</span><span class="p">,</span> <span class="n">resamples</span><span class="p">)</span>
    <span class="n">current_info_rel</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">current_info_rel</span> <span class="o">=</span> <span class="n">estimator_function</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),:])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">335</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;GO_term pure informativity&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">336</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Density of current in the highlighted area&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                       <span class="n">select</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                       <span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                               <span class="n">select</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                               <span class="n">select</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">selector</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="c"># this property is better off viewed as a scatterplot of true points and default points</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">337</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Clustering correlation&#39;</span><span class="p">)</span>
    <span class="c"># plt.scatter(meancorrs[0, :], meancorrs[1, :], color = &#39;b&#39;)</span>
    <span class="n">estimator_function</span> <span class="o">=</span> <span class="n">kde_compute</span><span class="p">(</span><span class="n">meancorrs</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">:],</span> <span class="mi">50</span><span class="p">,</span> <span class="n">resamples</span><span class="p">)</span>
    <span class="n">cluster_props</span> <span class="o">=</span><span class="bp">None</span>
    <span class="k">if</span> <span class="n">test_meancorr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test_meancorr</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">test_meancorr</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">cluster_props</span> <span class="o">=</span> <span class="n">estimator_function</span><span class="p">(</span><span class="n">test_meancorr</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),:])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">338</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Eigvals_hist&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">eigval</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">eigval</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eigvals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eigval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eigval</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">339</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;confusion potential&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_tri_corr_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">test_tri_corr_array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c"># pull the groups corresponding to non-random associations.</span>
    <span class="k">return</span> <span class="n">current_info_rel</span><span class="p">,</span> <span class="n">cluster_props</span>

</div>
<div class="viewcode-block" id="perform_clustering"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.perform_clustering">[docs]</a><span class="k">def</span> <span class="nf">perform_clustering</span><span class="p">(</span><span class="n">internode_tension</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs a clustering on the voltages of the nodes,</span>

<span class="sd">    :param internode_tension:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idxgroup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span> <span class="n">item</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">internode_tension</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">key</span> <span class="p">]))</span>
    <span class="n">local_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">UP</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">UP</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxgroup</span><span class="p">))</span>
    <span class="n">rev_idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">UP</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">UP</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxgroup</span><span class="p">))</span>
    <span class="n">relmat</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idxgroup</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxgroup</span><span class="p">)))</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">UP1</span><span class="p">,</span> <span class="n">UP2</span><span class="p">),</span> <span class="n">tension</span> <span class="ow">in</span> <span class="n">internode_tension</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">relmat</span><span class="p">[</span><span class="n">local_index</span><span class="p">[</span><span class="n">UP1</span><span class="p">],</span> <span class="n">local_index</span><span class="p">[</span><span class="n">UP2</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">tension</span>
        <span class="n">relmat</span><span class="p">[</span><span class="n">local_index</span><span class="p">[</span><span class="n">UP2</span><span class="p">],</span> <span class="n">local_index</span><span class="p">[</span><span class="n">UP1</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">tension</span>
        <span class="n">relmat</span><span class="p">[</span><span class="n">local_index</span><span class="p">[</span><span class="n">UP2</span><span class="p">],</span> <span class="n">local_index</span><span class="p">[</span><span class="n">UP2</span><span class="p">]]</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">tension</span>
        <span class="n">relmat</span><span class="p">[</span><span class="n">local_index</span><span class="p">[</span><span class="n">UP1</span><span class="p">],</span> <span class="n">local_index</span><span class="p">[</span><span class="n">UP1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">tension</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="n">cluster_nodes</span><span class="p">(</span><span class="n">relmat</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>

    <span class="n">relmat</span> <span class="o">=</span> <span class="n">Lapl_normalize</span><span class="p">(</span><span class="n">relmat</span><span class="p">)</span>
    <span class="n">eigenvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">relmat</span><span class="p">)</span>
    <span class="n">relmat</span> <span class="o">=</span> <span class="o">-</span><span class="n">relmat</span>
    <span class="n">relmat</span><span class="o">.</span><span class="n">setdiag</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">groupsets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">group2average_offdiag</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
        <span class="n">group_selector</span> <span class="o">=</span> <span class="n">groups</span><span class="o">==</span><span class="n">i</span>
        <span class="n">group_idxs</span> <span class="o">=</span> <span class="n">group_selector</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">group2average_offdiag</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rev_idx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">group_idxs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_idxs</span><span class="p">),</span> <span class="n">submatrix</span><span class="p">(</span><span class="n">relmat</span><span class="p">,</span> <span class="n">group_idxs</span><span class="p">,</span> <span class="bp">False</span><span class="p">)))</span>
        <span class="n">groupsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_idxs</span><span class="p">)</span>

    <span class="n">remainder</span> <span class="o">=</span> <span class="n">remaineder_matrix</span><span class="p">(</span><span class="n">relmat</span><span class="p">,</span> <span class="n">groupsets</span><span class="p">)</span>

    <span class="n">clustidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">itemset</span> <span class="ow">in</span> <span class="n">groupsets</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemset</span><span class="p">])</span>
    <span class="n">relmat</span> <span class="o">=</span> <span class="n">relmat</span><span class="p">[:,</span> <span class="n">clustidx</span><span class="p">]</span>
    <span class="n">relmat</span> <span class="o">=</span> <span class="n">relmat</span><span class="p">[</span><span class="n">clustidx</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">mean_corr_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">items</span><span class="p">,</span> <span class="n">mean_corr</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">mean_corr</span> <span class="ow">in</span> <span class="n">group2average_offdiag</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">relmat</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&quot;nearest&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">group2average_offdiag</span><span class="p">),</span> <span class="n">remainder</span><span class="p">,</span> <span class="n">mean_corr_array</span><span class="p">,</span> <span class="n">eigenvals</span>

    <span class="c"># TODO: define this as a routine for the general grouping later on.</span>

</div>
<div class="viewcode-block" id="compare_to_blanc"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.compare_to_blanc">[docs]</a><span class="k">def</span> <span class="nf">compare_to_blanc</span><span class="p">(</span><span class="n">blanc_model_size</span><span class="p">,</span> <span class="n">zoom_range_selector</span><span class="p">,</span> <span class="n">real_knowledge_interface</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recovers the statistics on the circulation nodes and shows the visual of a circulation system</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">KG_gen</span><span class="p">()</span>
    <span class="n">MD5_hash</span> <span class="o">=</span> <span class="n">KG</span><span class="o">.</span><span class="n">_MD5hash</span><span class="p">()</span>

    <span class="n">curr_inf_conf_general</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">meancorr_acccumulator</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eigval_accumulator</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># this part computes the items required for the creation of a blanc model</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">UP_rand_samp</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="n">blanc_model_size</span><span class="p">,</span><span class="s">&#39;sys_hash&#39;</span> <span class="p">:</span> <span class="n">MD5_hash</span><span class="p">})):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">node_currs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s">&#39;currents&#39;</span><span class="p">])</span>
        <span class="n">tensions</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s">&#39;voltages&#39;</span><span class="p">])</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">meancorr</span><span class="p">,</span> <span class="n">eigvals</span> <span class="o">=</span> <span class="n">perform_clustering</span><span class="p">(</span><span class="n">tensions</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">meancorr_acccumulator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meancorr</span><span class="p">))</span>
        <span class="n">eigval_accumulator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span>
        <span class="n">Dic_system</span> <span class="o">=</span> <span class="n">KG</span><span class="o">.</span><span class="n">format_Node_props</span><span class="p">(</span><span class="n">node_currs</span><span class="p">)</span>
        <span class="n">curr_inf_conf</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Dic_system</span><span class="o">.</span><span class="n">itervalues</span><span class="p">())</span>
        <span class="n">curr_inf_conf_general</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">curr_inf_conf</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">i</span>

    <span class="c"># This part declares the pre-operators required for the verification of a real sample</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">curr_inf_conf_general</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">final_meancorrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">meancorr_acccumulator</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">final_eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">eigval_accumulator</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">curr_inf_conf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">meancorr</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">eigval</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">group2avg_offdiag</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">GO_node_ids</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">Dic_system</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">real_knowledge_interface</span><span class="p">:</span>
        <span class="n">node_currs</span> <span class="o">=</span> <span class="n">real_knowledge_interface</span><span class="o">.</span><span class="n">node_current</span>
        <span class="n">Dic_system</span> <span class="o">=</span> <span class="n">KG</span><span class="o">.</span><span class="n">format_Node_props</span><span class="p">(</span><span class="n">node_currs</span><span class="p">)</span>
        <span class="n">curr_inf_conf_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">Dic_system</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">GO_node_ids</span><span class="p">,</span> <span class="n">curr_inf_conf</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr_inf_conf_tot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">curr_inf_conf_tot</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">:])</span>
        <span class="n">group2avg_offdiag</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">meancorr</span><span class="p">,</span> <span class="n">eigval</span> <span class="o">=</span> <span class="n">perform_clustering</span><span class="p">(</span><span class="n">real_knowledge_interface</span><span class="o">.</span><span class="n">UP2UP_voltages</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>


    <span class="k">print</span> <span class="s">&quot;stats on </span><span class="si">%s</span><span class="s"> samples&quot;</span> <span class="o">%</span> <span class="n">count</span>

    <span class="c"># TODO: We could and should separate the visualisation from the gaussian estimators computation</span>
    <span class="n">r_nodes</span><span class="p">,</span> <span class="n">r_groups</span> <span class="o">=</span> <span class="n">show_corrs</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">final_meancorrs</span><span class="p">,</span> <span class="n">final_eigvals</span><span class="p">,</span> <span class="n">zoom_range_selector</span><span class="p">,</span> <span class="n">curr_inf_conf</span><span class="p">,</span> <span class="n">meancorr</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">eigval</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>


    <span class="n">GO_node_char</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;Node_Char&#39;</span><span class="p">,[</span><span class="s">&#39;current&#39;</span><span class="p">,</span><span class="s">&#39;informativity&#39;</span><span class="p">,</span> <span class="s">&#39;confusion_potential&#39;</span><span class="p">,</span> <span class="s">&#39;p_value&#39;</span><span class="p">])</span>
    <span class="n">Group_char</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;Group_Char&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;UPs&#39;</span><span class="p">,</span><span class="s">&#39;num_UPs&#39;</span><span class="p">,</span><span class="s">&#39;average_connection&#39;</span><span class="p">,</span><span class="s">&#39;p_value&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">r_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">not_random_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">GO_id</span><span class="p">))</span> <span class="k">for</span> <span class="n">GO_id</span> <span class="ow">in</span> <span class="n">GO_node_ids</span><span class="p">[</span><span class="n">r_nodes</span> <span class="o">&lt;</span> <span class="n">p_val</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="n">not_random_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">group2avg_offdiag</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r_groups</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">r_groups</span> <span class="o">&lt;</span> <span class="n">p_val</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">not_random_groups</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Group_char</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">nr_group</span><span class="p">))</span> <span class="k">for</span> <span class="n">nr_group</span> <span class="ow">in</span> <span class="n">not_random_groups</span><span class="p">]</span>

        <span class="n">dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">GO_id</span><span class="p">,</span>
                      <span class="nb">tuple</span><span class="p">([</span><span class="n">GO_node_char</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">Dic_system</span><span class="p">[</span><span class="n">GO_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">r_nodes</span><span class="p">[</span><span class="n">GO_node_ids</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">GO_id</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())),</span>
                              <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">KG</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="n">GO_id</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">real_knowledge_interface</span><span class="o">.</span><span class="n">analytic_Uniprots</span><span class="p">)))]))</span>
                     <span class="k">for</span> <span class="n">GO_id</span> <span class="ow">in</span> <span class="n">not_random_nodes</span><span class="p">)</span>

        <span class="k">return</span>  <span class="nb">sorted</span><span class="p">(</span><span class="n">dct</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span> <span class="n">not_random_groups</span>

    <span class="k">return</span>  <span class="bp">None</span>

</div>
<div class="viewcode-block" id="decide_regeneration"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.decide_regeneration">[docs]</a><span class="k">def</span> <span class="nf">decide_regeneration</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A script to decide at what point it is better to recompute a new a network rather then go through the time it</span>
<span class="sd">    requires to be upickled.</span>
<span class="sd">    The current decision is that for the samples of the size of ~ 100 Uniprots, we are better off unpickling from 4</span>
<span class="sd">    and more by factor 2 and by factor 10 from 9</span>
<span class="sd">    Previous experimets have shown that memoization with pickling incurred no noticeable delay on samples of up to</span>
<span class="sd">    50 UPs, but that the storage limit on mongo DB was rapidly exceeded, leading us to create an allocated dump file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sample_root</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;530239&#39;</span><span class="p">,</span> <span class="s">&#39;921394&#39;</span><span class="p">,</span> <span class="s">&#39;821224&#39;</span><span class="p">,</span> <span class="s">&#39;876133&#39;</span><span class="p">,</span> <span class="s">&#39;537471&#39;</span><span class="p">,</span> <span class="s">&#39;147771&#39;</span><span class="p">,</span> <span class="s">&#39;765141&#39;</span><span class="p">,</span> <span class="s">&#39;783757&#39;</span><span class="p">,</span> <span class="s">&#39;161100&#39;</span><span class="p">,</span> <span class="s">&#39;996641&#39;</span><span class="p">,</span>
    <span class="s">&#39;568357&#39;</span><span class="p">,</span> <span class="s">&#39;832606&#39;</span><span class="p">,</span> <span class="s">&#39;888857&#39;</span><span class="p">,</span> <span class="s">&#39;443125&#39;</span><span class="p">,</span> <span class="s">&#39;674855&#39;</span><span class="p">,</span> <span class="s">&#39;703465&#39;</span><span class="p">,</span> <span class="s">&#39;770454&#39;</span><span class="p">,</span> <span class="s">&#39;585061&#39;</span><span class="p">,</span> <span class="s">&#39;767349&#39;</span><span class="p">,</span> <span class="s">&#39;454684&#39;</span><span class="p">,</span> <span class="s">&#39;476323&#39;</span><span class="p">,</span>
    <span class="s">&#39;890779&#39;</span><span class="p">,</span> <span class="s">&#39;699374&#39;</span><span class="p">,</span> <span class="s">&#39;699085&#39;</span><span class="p">,</span> <span class="s">&#39;926841&#39;</span><span class="p">,</span> <span class="s">&#39;719433&#39;</span><span class="p">,</span> <span class="s">&#39;979188&#39;</span><span class="p">,</span> <span class="s">&#39;750252&#39;</span><span class="p">,</span> <span class="s">&#39;884148&#39;</span><span class="p">,</span> <span class="s">&#39;452226&#39;</span><span class="p">,</span> <span class="s">&#39;510869&#39;</span><span class="p">,</span> <span class="s">&#39;934804&#39;</span><span class="p">,</span>
    <span class="s">&#39;450711&#39;</span><span class="p">,</span> <span class="s">&#39;654463&#39;</span><span class="p">,</span> <span class="s">&#39;475017&#39;</span><span class="p">,</span> <span class="s">&#39;836128&#39;</span><span class="p">,</span> <span class="s">&#39;869961&#39;</span><span class="p">,</span> <span class="s">&#39;833908&#39;</span><span class="p">,</span> <span class="s">&#39;748293&#39;</span><span class="p">,</span> <span class="s">&#39;642129&#39;</span><span class="p">,</span> <span class="s">&#39;511971&#39;</span><span class="p">,</span> <span class="s">&#39;450103&#39;</span><span class="p">,</span> <span class="s">&#39;465344&#39;</span><span class="p">,</span>
    <span class="s">&#39;664249&#39;</span><span class="p">,</span> <span class="s">&#39;759667&#39;</span><span class="p">,</span> <span class="s">&#39;479667&#39;</span><span class="p">,</span> <span class="s">&#39;945097&#39;</span><span class="p">,</span> <span class="s">&#39;934005&#39;</span><span class="p">,</span> <span class="s">&#39;474459&#39;</span><span class="p">,</span> <span class="s">&#39;616764&#39;</span><span class="p">,</span> <span class="s">&#39;993605&#39;</span><span class="p">,</span> <span class="s">&#39;151251&#39;</span><span class="p">,</span> <span class="s">&#39;881579&#39;</span><span class="p">,</span> <span class="s">&#39;1010120&#39;</span><span class="p">,</span>
    <span class="s">&#39;567103&#39;</span><span class="p">,</span> <span class="s">&#39;177132&#39;</span><span class="p">,</span> <span class="s">&#39;914246&#39;</span><span class="p">,</span> <span class="s">&#39;818797&#39;</span><span class="p">,</span> <span class="s">&#39;734031&#39;</span><span class="p">,</span> <span class="s">&#39;983957&#39;</span><span class="p">,</span> <span class="s">&#39;988876&#39;</span><span class="p">,</span> <span class="s">&#39;907270&#39;</span><span class="p">,</span> <span class="s">&#39;764944&#39;</span><span class="p">,</span> <span class="s">&#39;457147&#39;</span><span class="p">,</span> <span class="s">&#39;574367&#39;</span><span class="p">,</span>
    <span class="s">&#39;605567&#39;</span><span class="p">,</span> <span class="s">&#39;950635&#39;</span><span class="p">,</span> <span class="s">&#39;184544&#39;</span><span class="p">,</span> <span class="s">&#39;372652&#39;</span><span class="p">,</span> <span class="s">&#39;440372&#39;</span><span class="p">,</span> <span class="s">&#39;630427&#39;</span><span class="p">,</span> <span class="s">&#39;446382&#39;</span><span class="p">,</span> <span class="s">&#39;195073&#39;</span><span class="p">,</span> <span class="s">&#39;790029&#39;</span><span class="p">,</span> <span class="s">&#39;941318&#39;</span><span class="p">,</span> <span class="s">&#39;572041&#39;</span><span class="p">,</span>
    <span class="s">&#39;469852&#39;</span><span class="p">,</span> <span class="s">&#39;1009569&#39;</span><span class="p">,</span> <span class="s">&#39;969215&#39;</span><span class="p">,</span> <span class="s">&#39;571784&#39;</span><span class="p">,</span> <span class="s">&#39;794977&#39;</span><span class="p">,</span> <span class="s">&#39;991385&#39;</span><span class="p">,</span> <span class="s">&#39;511515&#39;</span><span class="p">,</span> <span class="s">&#39;592947&#39;</span><span class="p">,</span> <span class="s">&#39;517667&#39;</span><span class="p">,</span> <span class="s">&#39;746802&#39;</span><span class="p">,</span> <span class="s">&#39;685187&#39;</span><span class="p">,</span>
    <span class="s">&#39;877373&#39;</span><span class="p">,</span> <span class="s">&#39;860329&#39;</span><span class="p">,</span> <span class="s">&#39;589231&#39;</span><span class="p">,</span> <span class="s">&#39;1013595&#39;</span><span class="p">,</span> <span class="s">&#39;679330&#39;</span><span class="p">,</span> <span class="s">&#39;808630&#39;</span><span class="p">,</span> <span class="s">&#39;774665&#39;</span><span class="p">,</span> <span class="s">&#39;663924&#39;</span><span class="p">,</span> <span class="s">&#39;615588&#39;</span><span class="p">,</span> <span class="s">&#39;497135&#39;</span><span class="p">,</span> <span class="s">&#39;628832&#39;</span><span class="p">,</span>
    <span class="s">&#39;841054&#39;</span><span class="p">,</span> <span class="s">&#39;657304&#39;</span><span class="p">]</span>
    <span class="n">rooot_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">sample_root</span><span class="p">)</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">KG_gen</span><span class="p">()</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">set_Uniprot_source</span><span class="p">(</span><span class="n">sample_root</span><span class="p">)</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">build_extended_conduction_system</span><span class="p">()</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">export_conduction_system</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">rooot_copy</span><span class="p">)</span>
        <span class="n">KG</span><span class="o">.</span><span class="n">export_subsystem</span><span class="p">(</span><span class="n">sample_root</span><span class="p">,</span><span class="n">rooot_copy</span><span class="p">[:</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;retrieve: </span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>
        <span class="n">KG</span><span class="o">.</span><span class="n">set_Uniprot_source</span><span class="p">(</span><span class="n">rooot_copy</span><span class="p">[:</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">KG</span><span class="o">.</span><span class="n">build_extended_conduction_system</span><span class="p">(</span><span class="n">memoized</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">KG</span><span class="o">.</span><span class="n">export_conduction_system</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;    redo: </span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="get_estimated_time"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.get_estimated_time">[docs]</a><span class="k">def</span> <span class="nf">get_estimated_time</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">,</span> <span class="n">operations_per_sec</span><span class="o">=</span><span class="mf">2.2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Short time to estimate the time required for the generation of random saples</span>

<span class="sd">    :param samples: size of the sample</span>
<span class="sd">    :param sample_sizes: times each sample size is sampled</span>
<span class="sd">    :param operations_per_sec: complex operations per second</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_size</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="n">sample_size</span><span class="o">*</span><span class="n">sample</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">operations_per_sec</span>
        <span class="k">print</span> <span class="s">&quot;Computing a sample of </span><span class="si">%s</span><span class="s"> proteins would take </span><span class="si">%s</span><span class="s"> secs. </span><span class="se">\t</span><span class="s"> Repeated </span><span class="si">%s</span><span class="s"> times: </span><span class="si">%s</span><span class="s"> h. Total time after phase: </span><span class="si">%s</span><span class="s"> h&quot;</span> <span class="o">%</span><span class="p">(</span>
            <span class="n">sample</span><span class="p">,</span> <span class="s">&quot;{0:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">operations_per_sec</span><span class="p">),</span>
            <span class="n">sample_size</span><span class="p">,</span> <span class="s">&quot;{0:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_size</span><span class="o">*</span><span class="n">sample</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">operations_per_sec</span><span class="o">/</span><span class="mi">3600</span><span class="p">),</span>
            <span class="s">&quot;{0:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">counter</span>

</div>
<div class="viewcode-block" id="linindep_GO_groups"><a class="viewcode-back" href="../../../PolyPharma.neo4j_analyzer.knowledge_access_analysis.html#PolyPharma.neo4j_analyzer.knowledge_access_analysis.linindep_GO_groups">[docs]</a><span class="k">def</span> <span class="nf">linindep_GO_groups</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs the analysis of linerly independent GO groups</span>

<span class="sd">    :param size:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KG</span> <span class="o">=</span> <span class="n">KG_gen</span><span class="p">()</span>
    <span class="n">KG</span><span class="o">.</span><span class="n">undump_Indep_Linset</span><span class="p">()</span>
    <span class="n">char_indexes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KG</span><span class="o">.</span><span class="n">GO2UP_Reachable_nodes</span><span class="p">[</span><span class="n">value</span><span class="p">]),</span> <span class="n">KG</span><span class="o">.</span><span class="n">GO_Legacy_IDs</span><span class="p">[</span><span class="n">value</span><span class="p">],</span> <span class="n">KG</span><span class="o">.</span><span class="n">GO_Names</span><span class="p">[</span><span class="n">value</span><span class="p">]))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">KG</span><span class="o">.</span><span class="n">Num2GO</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
    <span class="k">print</span> <span class="n">KG</span><span class="o">.</span><span class="n">pretty_time</span><span class="p">()</span>
    <span class="n">analyze_eigvects</span><span class="p">(</span><span class="n">KG</span><span class="o">.</span><span class="n">Indep_Lapl</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">char_indexes</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c"># spawn_sampler(([10, 100], [2, 1]))</span>
    <span class="n">spawn_sampler_pool</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,])</span>
    <span class="c"># get_estimated_time([10, 25, 50, 100,], [15, 10, 10, 8,])</span>
    <span class="c"># test_list = [&#39;186958&#39;, &#39;142401&#39;, &#39;147798&#39;, &#39;164077&#39;, &#39;162624&#39;, &#39;181770&#39;, &#39;113303&#39;, &#39;160359&#39;, &#39;133344&#39;, &#39;178502&#39;]</span>
    <span class="c"># KG = KG_gen()</span>
    <span class="c"># KG.set_Uniprot_source(test_list)</span>
    <span class="c"># KG.build_extended_conduction_system()</span>
    <span class="c"># KG.export_conduction_system()</span>
    <span class="c"># nr_nodes, nr_groups = compare_to_blanc(10, [1000, 1200], KG, p_val=0.5)</span>
    <span class="c"># # for item in nr_nodes:</span>
    <span class="c"># # print nr_groups</span>
    <span class="c"># linindep_GO_groups(50)</span>

    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PolyPharma 0.2a3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Andrei Kucharavy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>